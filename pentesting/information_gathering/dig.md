Les commandes `dig` (Domain Information Groper) sont essentielles pour les tests de sécurité relatifs aux DNS, car elles permettent de collecter des informations précieuses sur la configuration et les enregistrements DNS d'un domaine. Voici quelques commandes `dig` utiles pour la sécurité, en utilisant `example.com` comme domaine cible :

1. **Requête A (Adresse)**
   - `dig example.com A`
   - Cette commande récupère l'enregistrement d'adresse IPv4 du domaine, utile pour identifier l'adresse IP du serveur hébergeant le site.
2. **Requête AAAA (IPv6)**
   - `dig example.com AAAA`
   - Semblable à la requête A, mais pour l'adresse IPv6, fournissant des informations sur la connectivité IPv6 du domaine.
3. **Requête MX (Mail Exchange)**
   - `dig example.com MX`
   - Identifie les serveurs de messagerie (mail exchange servers) du domaine, crucial pour comprendre la gestion des emails et potentiellement les cibler lors de tests d'intrusion.
4. **Requête NS (Name Server)**
   - `dig example.com NS`
   - Récupère les serveurs de noms du domaine, offrant une vue sur la structure DNS et les vecteurs possibles d'attaque par empoisonnement de cache DNS.
5. **Requête SOA (Start of Authority)**
   - `dig example.com SOA`
   - Fournit des informations sur la zone DNS, y compris le serveur DNS primaire et l'email de l'administrateur, essentiel pour comprendre la hiérarchie et la gestion du domaine.
6. **Requête TXT (Text)**
   - `dig example.com TXT`
   - Récupère les enregistrements TXT, souvent utilisés pour la vérification de la propriété du domaine et les politiques SPF (Sender Policy Framework), importants pour évaluer les configurations anti-spoofing.
7. **Recherche de tous les enregistrements**
   - `dig example.com ANY`
   - Demande tous les enregistrements disponibles pour le domaine. Bien que cette commande soit parfois limitée par les serveurs DNS pour éviter les abus, elle peut révéler des informations exhaustives sur la configuration du domaine.
8. **Requête inversée**
   - `dig -x [Adresse IP]`
   - Effectue une recherche DNS inversée pour identifier le domaine ou les sous-domaines associés à une adresse IP donnée, utile pour cartographier le réseau derrière le domaine.
9. **Requête spécifiant un serveur DNS**
   - `dig @ns1.example.com example.com`
   - Effectue une requête en spécifiant un serveur DNS particulier. C'est utile pour tester la réponse d'un serveur DNS spécifique ou pour contourner les caches DNS locaux.
10. **Définition du temps d'expiration et du nombre de tentatives**
    - `dig example.com +time=10 +tries=1`
    - Configure un temps d'expiration pour la réponse et le nombre de tentatives de requête. Cela est particulièrement utile dans un environnement de test pour contrôler le trafic réseau et éviter des attentes prolongées.

--------------



Pour le pentesting, l'utilisation de `dig` peut être orientée vers la découverte d'informations, l'énumération de sous-domaines, et l'identification des configurations DNS faibles ou mal configurées. Voici une liste de commandes `dig` spécifiques et leur utilité dans le cadre d'un pentest:

1. **Découverte de sous-domaines**
   - Utiliser `dig` avec une liste de sous-domaines potentiels peut aider à identifier des sous-domaines non documentés ou oubliés. Cela nécessite un script ou un outil tiers pour itérer à travers une liste de sous-domaines connus.
   - Exemple basique (à automatiser avec un script) :

- ```css
  dig subdomain.example.com A
  ```

**Zone transfer**

- Tenter une transfert de zone peut révéler une mine d'informations si le serveur DNS est mal configuré.

- ```css
  dig @ns.example.com example.com AXFR
  ```

- Cette commande tente un transfert de zone du domaine `example.com` en utilisant le serveur DNS `ns.example.com`. Si réussi, cela peut révéler tous les enregistrements DNS du domaine.

**Identification de serveurs mail vulnérables**

- Les enregistrements MX peuvent être interrogés pour identifier les serveurs de messagerie, puis tester ces serveurs pour des vulnérabilités spécifiques.

- ```css
  dig example.com MX
  ```

**Recherche d'enregistrements SPF**

- Les enregistrements SPF (Sender Policy Framework) sont utilisés pour éviter le spoofing d'adresse e-mail. L'absence ou la mauvaise configuration d'un enregistrement SPF peut être exploitée pour du phishing.

- ```css
  dig example.com TXT
  ```

**Détection de la présence de serveurs cachés ou de balises**

- Parfois, des enregistrements A ou AAAA supplémentaires peuvent pointer vers des infrastructures non documentées ou sensibles.

- ```css
  dig example.com A
  dig example.com AAAA
  ```

**Énumération des serveurs DNS et analyse de leur configuration**

- En identifiant les serveurs DNS, un attaquant peut cibler ces systèmes pour des attaques de déni de service (DoS) ou tenter de les compromettre pour des attaques d'empoisonnement de cache DNS.

- ```css
  dig example.com NS
  ```

**Utilisation de `dig` pour des requêtes DNS inversées**

- Trouver les domaines associés à une adresse IP peut révéler des domaines cachés ou des services exécutés sur des adresses IP partagées.

- ```
  dig -x IP_Address
  ```

**Interrogation avec des flags spécifiques pour des informations détaillées**

- Utiliser des flags comme +trace pour suivre le chemin d'une requête DNS ou +short

   pour obtenir une réponse concise.

- ```sql
  dig example.com +trace
  dig example.com +short
  ```

**Tester la réponse du serveur DNS à des requêtes non standard**

- Essayer des requêtes pour des enregistrements non typiques ou inattendus peut révéler des configurations DNS faibles ou des vulnérabilités.

1. - ```sql
     dig example.com ANY
     dig @ns.example.com example.com CAA
     ```

Ces commandes devraient faire partie de l'arsenal de base pour les pentesters axés sur la reconnaissance et l'énumération DNS. Il est crucial de respecter l'éthique du pentesting en n'effectuant ces tests que sur des systèmes pour lesquels vous avez une autorisation explicite.